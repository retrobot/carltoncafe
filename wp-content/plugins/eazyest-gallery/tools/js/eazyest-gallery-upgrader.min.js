(function(e){function r(o){if(t){var u={action:"eazyest_gallery_upgrade_folder",gallery_folder:e("#gallery_folder").val(),images_max:e("#import_image_max").val(),allow_comments:e("input[name=allow_comments]:checked").val(),remove_cache:e("input[name=remove_cache]:checked").val(),remove_xml:e("input[name=remove_xml]:checked").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,u,function(t){if(t!="0"){var a=parseInt(t,10);if(a!=o){var f=parseInt(e("#current-folder").html());f++;e("#current-folder").html(f);e("#image-counter").hide();n=0}else{e("#image-counter").show();n=n+parseInt(u.images_max,10);e("#image-batch").html(n)}r(a)}else{e("#folder-counter").html(eazyestUpgraderSettings.ready);if("1"==e("input[name=convert_page]:checked").val()){i()}else{s()}}})}}function i(){if("1"==e("input[name=convert_page]:checked").val()&&t){e("#upgrade_page").show();var n={action:"eazyest_gallery_convert_page",gallery_folder:e("#gallery_folder").val(),gallery_id:e("#gallery_id").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(e){s()})}}function s(){if(t){e("#upgrade-settings").show();var n={action:"eazyest_gallery_update_settings",gallery_folder:e("#gallery_folder").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(t){e("#upgrade-cleanup").show();o()})}}function o(){if(t){var n={action:"eazyest_gallery_cleanup",gallery_folder:e("#gallery_folder").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(t){e("#start-upgrade").hide();e("#upgrade-process-title").html(eazyestUpgraderSettings.finished);e("#upgrade-success").show()})}}function u(){if(!t){e("#skip").hide();e("#abort").hide();e("#upgrade-process").show();e("#upgrade-error").hide();e("#start-upgrade").html(eazyestUpgraderSettings.stop);e("#start-upgrade").removeClass("button-primary");e("#upgrade-form :input").attr("disabled",true);t=true}else{e("#skip").show();e("#upgrade-process").hide();e("#current-folder").html("0");e("#start-upgrade").html(eazyestUpgraderSettings.restart);e("#start-upgrade").addClass("button-primary");t=false}if(t){var n={action:"eazyest_gallery_get_upgrade_folders",gallery_folder:e("#gallery_folder").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(n){if("empty"==n){e("#upgrade-error").show();e("#start-upgrade").html(eazyestUpgraderSettings.restart);t=false}else{var i=parseInt(n,10);if(i>0){e("#current-folder").html("1");e("#all-folders").html(i);e("#folder-counter").show();e("span.spinner").show();r(i)}}})}}var t=false;var n=0;e(document).ready(function(){e("#start-upgrade").click(function(){u();return false});e("#skip_upgrade").click(function(){e(this).parents("form").submit()});e("#gallery_folder").change(function(){var t={action:"eazyest_gallery_folder_change",_wpnonce:e("#gallery-folder-nonce").val(),gallery_folder:e("#gallery_folder").val()};e.post(ajaxurl,t,function(t){if(0==t.result){e("#eazyest-ajax-response").hide();e("#create-folder").hide()}else{if(1==t.result){e("#eazyest-ajax-response").html(eazyestUpgraderSettings.errorMessage.replace("%s","<code>"+e("#gallery_folder").val()+"</code>")).show("fast",function(){e("#gallery_folder").val(t.folder)})}else{e("#eazyest-ajax-response").html(eazyestUpgraderSettings.notExistsMessage).show("fast",function(){e("#gallery_folder").val(t.folder)})}}});return false})})})(jQuery)